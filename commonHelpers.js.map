{"version":3,"file":"commonHelpers.js","sources":["../src/js/render-functions.js","../src/js/pixabay-api.js","../src/main.js"],"sourcesContent":["export const renderGallery = (articleContainer, images) => {\n  const createMarkupPage = images.map(article => {\n    return `\n    <div class=\"photo-card\">\n        <a class =\"thumb\" href=\"${article.largeImageURL}\"><img class=\"img\" src=\"${article.webformatURL}\" alt=\"${article.tags}\" loading=\"lazy\" /> </a> \n      <div class=\"info\">\n        <p class=\"info-item\">\n          <b>Likes</b>\n          ${article.likes}\n        </p>\n        <p class=\"info-item\">\n          <b>Views</b>\n          ${article.views}\n        </p>\n        <p class=\"info-item\">\n          <b>Comments</b>\n          ${article.comments}\n        </p>\n        <p class=\"info-item\">\n          <b>Downloads</b>\n          ${article.downloads}\n        </p>\n      </div>\n    </div>\n  `;\n})\n.join('');\n\n   articleContainer.insertAdjacentHTML('beforeend', createMarkupPage);\n\n}","import axios from 'axios';\n\nconst API_KEY  = '31511712-b53d42f48d96ff6235f6befd4';\naxios.defaults.baseURL = 'https://pixabay.com/api/';\n\nexport async function fetchArticles(value, currentPage, perPage = 15) {\n  try {\n    const res = await axios.get(`?key=${API_KEY}&q=${value}&image_type=photo&orientation=horizontal&safesearch=true&page=${currentPage}&per_page=${perPage}`);\n    return res.data;\n  } catch (error) {\n    throw error;\n  }\n}\n\n// export async function fetchArticles(value, currentPage) {\n//   try {\n//     const res = await axios.get(`?key=${API_KEY}&q=${value}&image_type=photo&orientation=horizontal&safesearch=true&page=${currentPage}&per_page=15`);\n    \n//     // Проверяем, если количество изображений на сервере меньше 15\n//     const remainingImages = res.data.totalHits - (currentPage - 1) * 15;\n//     const imagesToFetch = Math.min(remainingImages, 15);\n    \n//     // Если осталось меньше 15 изображений, загружаем только их\n//     const finalRes = {\n//       ...res.data,\n//       hits: res.data.hits.slice(0, imagesToFetch)\n//     };\n    \n//     return finalRes;\n//   } catch (error) {\n//     throw error;\n//   }\n// }","import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nimport { renderGallery } from \"./js/render-functions\"; \nimport { fetchArticles } from \"./js/pixabay-api\";\n\nconst articleContainer = document.querySelector('.gallery');\nconst loaderMarkup  = '<div id=\"loader\" class=\"loader\"></div>';\n\nconst searchForm = document.querySelector('.search-form');\nconst searchInputElement = document.querySelector('input[class=\"form-control\"]');\n\n\nlet photos = [];\nlet form = null;\nlet currentPage = 1;\nlet totalImages = 0;\nlet perPage = 15;\n\nlet lightbox = new SimpleLightbox('.gallery a');\n\n\nconst searchBtn = document.querySelector('.btn-submit');\nconst loadMoreBtn = document.querySelector('[data-action=\"load-more\"]');\n\n\nsearchForm.addEventListener('submit', handleFormSubmit);\n  \n  function handleFormSubmit(e) { \n    e.preventDefault();\n    resetPage();\n\n  form = (e.currentTarget.elements.searchQuery.value).trim();\n   if (form === null || form === '') {\n    iziToast.info({\n    title: 'Please type something in the search input',\n      position: 'topRight',\n    });\n   } else {\n     loadMoreBtn.style.display = 'none';\n     main(form)\n     searchForm.reset();\n  }\n\n  }\n\n\nsearchInputElement.addEventListener('input', () => {\n  const inputValue = searchInputElement.value.trim();\n  if (inputValue) {\n    searchBtn.disabled = false;\n  } else {\n    searchBtn.disabled = true;\n  }\n});\n\nasync function main(value) {\n  try {\n    articleContainer.insertAdjacentHTML(\"beforebegin\", loaderMarkup);\n    clearArticlesContainer();\n\n    const images = await fetchArticles(value, currentPage, perPage);\n    if (images && images.hits.length > 0) {\n      photos = [...images.hits];\n      totalImages = images.totalHits;\n      removeLoaderSpinner();\n      renderGallery(articleContainer, photos);\n      loadMoreBtn.style.display = 'block';\n      searchBtn.disabled = true;\n    } else {\n      removeLoaderSpinner();\n      loadMoreBtn.style.display = 'none';\n      iziToast.error({\n        title: 'Sorry, there are no images matching your search query',\n        position: 'topRight',\n      });\n      clearArticlesContainer();\n    }\n    \n\n    lightbox.refresh();\n  } catch (error) {\n    console.log(error);\n  }\n}\n\n\nfunction removeLoaderSpinner() {\n  const loaderSpinner = document.querySelector('#loader');\n  if (loaderSpinner) {\n    loaderSpinner.remove();\n  }\n}\n\nloadMoreBtn.addEventListener('click', () => addCards(form));\n\n// async function addCards(form) {\n//   loadMoreBtn.insertAdjacentHTML(\"beforebegin\", loaderMarkup);\n//   incrementPage();\n\n//   try {\n    \n//   let maxPageNumber = totalImages / 15;\n//   let maxPageNumberRoundUp = Math.ceil(maxPageNumber);\n   \n//     const restPhoto = await fetchArticles(form, currentPage, perPage);\n//     photos = [...restPhoto.hits];\n\n//     if (currentPage === maxPageNumberRoundUp) {\n//       loadMoreBtn.style.display = 'none';\n//       iziToast.info({\n//         title: \"We're sorry, but you've reached the end of search results.\",\n//         position: 'topRight',\n//       });\n\n//     }\n\n//      if (totalImages < 15) { \n//         perPage = totalImages\n//         const restPhoto = await fetchArticles(form, currentPage, perPage);\n//         photos = [...restPhoto.hits];\n//        removeLoaderSpinner();\n//      }\n      \n//      removeLoaderSpinner();\n//      renderGallery(articleContainer, photos);\n//      scrollToElementHeight();\n//      lightbox.refresh();\n\n//   }\n//   } catch (error) {\n//     console.log(error)\n//   }\n// }\n\nasync function addCards(form) {\n  loadMoreBtn.insertAdjacentHTML(\"beforebegin\", loaderMarkup);\n  incrementPage();\n\n  try {\n    let maxPageNumber = totalImages / 15;\n    let maxPageNumberRoundUp = Math.ceil(maxPageNumber);\n   \n    const restPhoto = await fetchArticles(form, currentPage, perPage);\n    photos = [...restPhoto.hits];\n\n    if (currentPage === maxPageNumberRoundUp) {\n      loadMoreBtn.style.display = 'none';\n     \n      perPage = totalImages; // Adjust perPage to totalImages\n      const restPhoto = await fetchArticles(form, currentPage, perPage);\n      photos = [...restPhoto.hits];\n      removeLoaderSpinner();\n\n      iziToast.info({\n        title: \"We're sorry, but you've reached the end of search results.\",\n        position: 'topRight',\n      });\n\n    }\n\n    removeLoaderSpinner();\n    renderGallery(articleContainer, photos);\n    scrollToElementHeight();\n    lightbox.refresh();\n  } catch (error) {\n    console.log(error);\n  }\n}\n\n\nfunction clearArticlesContainer() {\n  articleContainer.innerHTML = '';\n}\n\n\nfunction resetPage() {\n  currentPage = 1;\n} \n\nfunction incrementPage() {\n  currentPage += 1;\n}\n\n\nfunction scrollToDistance(distance) {\n  const delay = 500;\n  const scrollTimeout = setTimeout(() => {\n    window.scrollBy({\n      top: distance * 1.5,\n      left: 0,\n      behavior: 'smooth',\n    });\n    clearTimeout(scrollTimeout);\n  }, delay);\n};\n\nfunction scrollToElementHeight(){\n  const galleryItemElement = document.querySelector('.photo-card');\n  const galleryItemRect = galleryItemElement.getBoundingClientRect();\n  scrollToDistance(galleryItemRect.height);\n};\n\n\n\n\n"],"names":["renderGallery","articleContainer","images","createMarkupPage","article","API_KEY","axios","fetchArticles","value","currentPage","perPage","error","loaderMarkup","searchForm","searchInputElement","photos","form","totalImages","lightbox","SimpleLightbox","searchBtn","loadMoreBtn","handleFormSubmit","e","resetPage","iziToast","main","clearArticlesContainer","removeLoaderSpinner","loaderSpinner","addCards","incrementPage","maxPageNumber","maxPageNumberRoundUp","scrollToElementHeight","scrollToDistance","distance","scrollTimeout","galleryItemRect"],"mappings":"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"}